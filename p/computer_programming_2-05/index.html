<!doctype html><html lang=en-us>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Program Argument argc, argv 1 2 3 4 5 6 7 8 9  #include &amp;lt;stdio.h&amp;gt;#include &amp;lt;stdlib.h&amp;gt;#include &amp;lt;stdint.h&amp;gt;int main(int argc, char *argv[]) { printf(&amp;#34;argc: %d\n&amp;#34;, argc); for(int32_t i = 0 ; i &amp;lt; argc ; i++) printf(&amp;#34;argv[%d]: %s\n&amp;#34;, i, argv[i]); return 0; }    誰呼叫了 main 函式? 誰提供了 argc 和 argv 到 main 函式? Is main() the actual starting entry point?  No! Actually, the process start from _start which is defined in crt1."><title>程式設計(二)-05：Variable Length Arguments List</title>
<link rel=canonical href=https://blog.smallten.tk/p/computer_programming_2-05/>
<link rel=stylesheet href=/scss/style.min.7b8cb8fa5c406df3cf5354584c5cbdb3b331e5fd452f9fe1168d563c1504f6de.css><meta property="og:title" content="程式設計(二)-05：Variable Length Arguments List">
<meta property="og:description" content="Program Argument argc, argv 1 2 3 4 5 6 7 8 9  #include &amp;lt;stdio.h&amp;gt;#include &amp;lt;stdlib.h&amp;gt;#include &amp;lt;stdint.h&amp;gt;int main(int argc, char *argv[]) { printf(&amp;#34;argc: %d\n&amp;#34;, argc); for(int32_t i = 0 ; i &amp;lt; argc ; i++) printf(&amp;#34;argv[%d]: %s\n&amp;#34;, i, argv[i]); return 0; }    誰呼叫了 main 函式? 誰提供了 argc 和 argv 到 main 函式? Is main() the actual starting entry point?  No! Actually, the process start from _start which is defined in crt1.">
<meta property="og:url" content="https://blog.smallten.tk/p/computer_programming_2-05/">
<meta property="og:site_name" content="小十的部落格">
<meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="C"><meta property="article:published_time" content="2021-07-12T21:57:26+08:00"><meta property="article:modified_time" content="2021-07-12T21:57:26+08:00">
<meta name=twitter:title content="程式設計(二)-05：Variable Length Arguments List">
<meta name=twitter:description content="Program Argument argc, argv 1 2 3 4 5 6 7 8 9  #include &amp;lt;stdio.h&amp;gt;#include &amp;lt;stdlib.h&amp;gt;#include &amp;lt;stdint.h&amp;gt;int main(int argc, char *argv[]) { printf(&amp;#34;argc: %d\n&amp;#34;, argc); for(int32_t i = 0 ; i &amp;lt; argc ; i++) printf(&amp;#34;argv[%d]: %s\n&amp;#34;, i, argv[i]); return 0; }    誰呼叫了 main 函式? 誰提供了 argc 和 argv 到 main 函式? Is main() the actual starting entry point?  No! Actually, the process start from _start which is defined in crt1.">
<link rel="shortcut icon" href=/image/favicon.png>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9L51K4B2CR"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-9L51K4B2CR',{anonymize_ip:!1})}</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9L51K4B2CR"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-9L51K4B2CR',{anonymize_ip:!1})}</script>
</head>
<body class="article-page has-toc">
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex
extended">
<div id=article-toolbar>
<a href=/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>Back</span>
</a>
</div>
<main class="main full-width">
<article class=main-article>
<header class=article-header>
<div class=article-details>
<header class=article-category>
<a href=/categories/%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88%E4%BA%8C/>
程式設計(二)
</a>
</header>
<h2 class=article-title>
<a href=/p/computer_programming_2-05/>程式設計(二)-05：Variable Length Arguments List</a>
</h2>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jul 12, 2021</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
5 minute read
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<h1 id=program-argument>Program Argument</h1>
<h3 id=argc-argv>argc, argv</h3>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span><span class=cp>#include</span> <span class=cpf>&lt;stdint.h&gt;</span><span class=cp>
</span><span class=cp></span><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span> <span class=p>{</span>
    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;argc: %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>argc</span><span class=p>);</span>
    <span class=k>for</span><span class=p>(</span><span class=kt>int32_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span> <span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>argc</span> <span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
        <span class=n>printf</span><span class=p>(</span><span class=s>&#34;argv[%d]: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>argv</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>誰呼叫了 main 函式?</li>
<li>誰提供了 <code>argc</code> 和 <code>argv</code> 到 main 函式?</li>
<li>Is <code>main()</code> the actual starting entry point?
<ul>
<li>No! Actually, the process start from <code>_start</code> which is defined in <code>crt1.o</code>.</li>
<li>等等&mldr; 我並沒有使用 <code>crt1.o</code> 呀!</li>
<li>實際上是有的。請查看 <code>gcc -v</code>
<code>$ nm /usr/lib/x86_64-linux-gnu/crt1.o</code></li>
</ul>
</li>
<li>Simplified C Linking Process
<img src=/p/computer_programming_2-05/computer_programming_2-05-01.jpg width=903 height=657 srcset="/p/computer_programming_2-05/computer_programming_2-05-01_hu609b65fe33cfb39abc5fd9afd4fd484b_119236_480x0_resize_q75_box.jpg 480w, /p/computer_programming_2-05/computer_programming_2-05-01_hu609b65fe33cfb39abc5fd9afd4fd484b_119236_1024x0_resize_q75_box.jpg 1024w" loading=lazy class=gallery-image data-flex-grow=137 data-flex-basis=329px></li>
<li>main() 是如何取得 argc, argv 的?
<ul>
<li>Actually, <code>_start</code> will prepare argc and argv first.</li>
<li>Then <code>_start</code> will register main function to <code>__libc_start_main</code>.</li>
<li><code>_start</code> will call <code>__libc_start_main</code> and <code>__libc_start_main</code> will call main.</li>
<li>More details will be described in Assembly.</li>
</ul>
</li>
</ul>
<h3 id=getopt>getopt</h3>
<p><code>int getopt(int argc, char * const argv[], const char *optstring);</code></p>
<ul>
<li>The getopt() function parses the command-line arguments. Its arguments argc and argv are the argument count and array as passed to the main() function on program invocation. An element of argv that starts with ’-’ (and is not exactly ”-” or ”–”) is an option element. The characters of this element (aside from the initial ’-’) are option characters. If getopt() is called repeatedly, it returns successively each of the option characters from each of the option elements.</li>
<li>提醒：這是一個 <code>POSIX 標準</code>而不是 C 標準。</li>
<li>extern 變數
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=k>extern</span> <span class=kt>char</span> <span class=o>*</span><span class=n>optarg</span><span class=p>;</span>
<span class=k>extern</span> <span class=kt>int</span> <span class=n>optind</span><span class=p>,</span> <span class=n>opterr</span><span class=p>,</span> <span class=n>optopt</span><span class=p>;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>這意味著我們可以在程式中使用這些變數。</li>
</ul>
</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span><span class=cp>#include</span> <span class=cpf>&lt;stdint.h&gt;</span><span class=cp>
</span><span class=cp>#include</span> <span class=cpf>&lt;unistd.h&gt;</span><span class=cp>
</span><span class=cp></span>
<span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span> <span class=p>{</span>
    <span class=kt>int32_t</span> <span class=n>c</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
    <span class=k>while</span><span class=p>((</span><span class=n>c</span> <span class=o>=</span> <span class=n>getopt</span><span class=p>(</span><span class=n>argc</span><span class=p>,</span> <span class=n>argv</span><span class=p>,</span> <span class=s>&#34;ab:&#34;</span><span class=p>))</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>switch</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>case</span> <span class=sc>&#39;a&#39;</span><span class=o>:</span>
                <span class=n>printf</span><span class=p>(</span> <span class=s>&#34;option: -a</span><span class=se>\n</span><span class=s>&#34;</span> <span class=p>);</span>
                <span class=k>break</span><span class=p>;</span>
            <span class=k>case</span> <span class=sc>&#39;b&#39;</span><span class=o>:</span>
                <span class=n>printf</span><span class=p>(</span> <span class=s>&#34;option: -b, %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>optarg</span> <span class=p>);</span>
            <span class=k>case</span> <span class=sc>&#39;?&#39;</span><span class=o>:</span>
                <span class=n>printf</span><span class=p>(</span> <span class=s>&#34;option: ?</span><span class=se>\n</span><span class=s>&#34;</span> <span class=p>);</span>
                <span class=k>break</span><span class=p>;</span>
            <span class=k>default</span><span class=o>:</span>
                <span class=n>printf</span><span class=p>(</span> <span class=s>&#34;option: unknown</span><span class=se>\n</span><span class=s>&#34;</span> <span class=p>);</span> 
                <span class=k>break</span><span class=p>;</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>optstring
<ul>
<li>optstring 是一個包含合法選項字符的字符串。</li>
<li>Example: <code>"abc"</code> implies supporting <code>-a</code>, <code>-b</code>, <code>-c</code>.</li>
<li><code>-ab</code>, <code>-bc</code>, <code>-ac</code>, <code>-abc</code> are also supported.</li>
<li>如果這樣的字符後跟一個冒號，則意味著該選項需要一個參數。 <code>optarg</code> 為參數值。</li>
</ul>
</li>
<li>回傳值
<ul>
<li>如果成功找到選項，則 getopt() 回傳選項字符。</li>
<li>如果所有命令行選項都已解析，則 getopt() 回傳 -1。</li>
<li>如果 getopt() 遇到不在 optstring 中的選項字符，則返回 <code>'?'</code>。</li>
<li>如果 getopt() 遇到缺少參數的選項，則返回值取決於 optstring 中的第一個字符：
<ul>
<li>如果是<code>':'</code>，則返回<code>':'</code>；</li>
<li>否則返回<code>'?'</code>。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id=getopt_long>getopt_long</h3>
<p><code>int getopt_long(int argc, char * const argv[], const char *optstring, const struct option *longopts, int *longindex);</code></p>
<ul>
<li>The getopt_long() function works like getopt() except that it also accepts long options, started with two dashes. If the program accepts only long options, then optstring should be specified as an empty string (””), not NULL. Long option names may be abbreviated if the abbreviation is unique or is an exact match for some defined option. A long option may take a parameter, of the form –arg=param or –arg param.</li>
<li>If longindex is not NULL, it points to a variable which is set to the index of the long option relative to longopts.</li>
<li>struct option
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=k>struct</span> <span class=n>option</span> <span class=p>{</span>
    <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>name</span><span class=p>;</span>
    <span class=kt>int</span> <span class=n>has_arg</span><span class=p>;</span>
    <span class=kt>int</span> <span class=o>*</span><span class=n>flag</span><span class=p>;</span>
    <span class=kt>int</span> <span class=n>val</span><span class=p>;</span>
<span class=p>};</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>name: the name of the long option.</li>
<li>has_arg:
<ul>
<li>0: no arguments.</li>
<li>1: required arguments.</li>
<li>2: optional arguments.</li>
</ul>
</li>
<li>flag: specifies how results are returned for a long option.</li>
<li>val: the value to return, or to load into the variable pointed to by flag.</li>
</ul>
</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span><span class=cp>#include</span> <span class=cpf>&lt;stdint.h&gt;</span><span class=cp>
</span><span class=cp>#include</span> <span class=cpf>&lt;unistd.h&gt;</span><span class=cp>
</span><span class=cp>#include</span> <span class=cpf>&lt;getopt.h&gt;</span><span class=cp>
</span><span class=cp></span>
<span class=k>struct</span> <span class=n>option</span> <span class=n>long_options</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span>  
     <span class=p>{</span><span class=s>&#34;all&#34;</span><span class=p>,</span>  <span class=mi>0</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=sc>&#39;a&#39;</span><span class=p>},</span>
     <span class=p>{</span><span class=s>&#34;break&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=sc>&#39;b&#39;</span><span class=p>},</span>
     <span class=p>{</span><span class=s>&#34;cancel&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=sc>&#39;c&#39;</span><span class=p>},</span>
     <span class=p>{</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>},</span>
<span class=p>};</span>

<span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span> <span class=p>{</span>
    <span class=kt>int32_t</span> <span class=n>c</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>index</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
    <span class=k>while</span><span class=p>((</span><span class=n>c</span> <span class=o>=</span> <span class=n>getopt_long</span><span class=p>(</span><span class=n>argc</span><span class=p>,</span> <span class=n>argv</span><span class=p>,</span> <span class=s>&#34;abc:&#34;</span><span class=p>,</span> <span class=n>long_options</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>index</span><span class=p>))</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>printf</span><span class=p>(</span><span class=s>&#34;index: %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>index</span><span class=p>);</span>
        <span class=k>switch</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>case</span> <span class=sc>&#39;a&#39;</span><span class=o>:</span>
                <span class=n>printf</span><span class=p>(</span> <span class=s>&#34;option: -a</span><span class=se>\n</span><span class=s>&#34;</span> <span class=p>);</span>
                <span class=k>break</span><span class=p>;</span>
            <span class=k>case</span> <span class=sc>&#39;b&#39;</span><span class=o>:</span>
                <span class=n>printf</span><span class=p>(</span> <span class=s>&#34;option: -b</span><span class=se>\n</span><span class=s>&#34;</span> <span class=p>);</span>
                <span class=k>break</span><span class=p>;</span>
            <span class=k>case</span> <span class=sc>&#39;c&#39;</span><span class=o>:</span>
                <span class=n>printf</span><span class=p>(</span> <span class=s>&#34;option: -c, %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>optarg</span> <span class=p>);</span>
                <span class=k>break</span><span class=p>;</span>
            <span class=k>case</span> <span class=sc>&#39;?&#39;</span><span class=o>:</span>
                <span class=n>printf</span><span class=p>(</span> <span class=s>&#34;option: ?</span><span class=se>\n</span><span class=s>&#34;</span> <span class=p>);</span>
                <span class=k>break</span><span class=p>;</span>
            <span class=k>default</span><span class=o>:</span>
                <span class=n>printf</span><span class=p>(</span> <span class=s>&#34;option: unknown</span><span class=se>\n</span><span class=s>&#34;</span> <span class=p>);</span> 
                <span class=k>break</span><span class=p>;</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id=variable-length-arguments>Variable Length Arguments</h1>
<ul>
<li>可變長度參數是一項功能，允許函數接收任意數量的參數。</li>
<li>可變數量的參數由三個點表示 <code>...</code>。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=cp>#include</span> <span class=cpf>&lt;stdarg.h&gt;</span><span class=cp>
</span><span class=cp></span><span class=kt>void</span> <span class=nf>va_start</span><span class=p>(</span><span class=n>va_list</span> <span class=n>ap</span><span class=p>,</span> <span class=n>last</span><span class=p>);</span>
<span class=n>type</span> <span class=nf>va_arg</span><span class=p>(</span><span class=n>va_list</span> <span class=n>ap</span><span class=p>,</span> <span class=n>type</span><span class=p>);</span>
<span class=kt>void</span> <span class=nf>va_end</span><span class=p>(</span><span class=n>va_list</span> <span class=n>ap</span><span class=p>);</span>
<span class=kt>void</span> <span class=nf>va_copy</span><span class=p>(</span><span class=n>va_list</span> <span class=n>dest</span><span class=p>,</span> <span class=n>va_list</span> <span class=n>src</span><span class=p>);</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>Actually, they are macros instead of functions.</li>
<li>範例一： printargs.c
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span><span class=cp>#include</span> <span class=cpf>&lt;stdarg.h&gt;</span><span class=cp>
</span><span class=cp>#include</span> <span class=cpf>&lt;stdint.h&gt;</span><span class=cp>
</span><span class=cp></span><span class=cm>/* print all args one at a time until a negative argument is seen;
</span><span class=cm>all args are assumed to be of int type */</span>
<span class=kt>void</span> <span class=nf>printargs</span><span class=p>(</span><span class=kt>int32_t</span> <span class=n>arg1</span><span class=p>,</span> <span class=p>...)</span> <span class=p>{</span>
    <span class=n>va_list</span> <span class=n>ap</span><span class=p>;</span>
    <span class=kt>int32_t</span> <span class=n>i</span><span class=p>;</span>
    <span class=n>va_start</span><span class=p>(</span> <span class=n>ap</span><span class=p>,</span> <span class=n>arg1</span> <span class=p>);</span> 
    <span class=k>for</span><span class=p>(</span><span class=kt>int32_t</span> <span class=n>i</span> <span class=o>=</span> <span class=n>arg1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>=</span> <span class=n>va_arg</span><span class=p>(</span><span class=n>ap</span><span class=p>,</span> <span class=kt>int32_t</span><span class=p>))</span>
        <span class=n>printf</span><span class=p>(</span> <span class=s>&#34;%d &#34;</span><span class=p>,</span> <span class=n>i</span><span class=p>);</span>
    <span class=n>va_end</span><span class=p>(</span> <span class=n>ap</span> <span class=p>);</span>
    <span class=n>putchar</span><span class=p>(</span><span class=sc>&#39;\n&#39;</span><span class=p>);</span>
    <span class=k>return</span><span class=p>;</span>
<span class=p>}</span>
<span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
    <span class=n>printargs</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>14</span><span class=p>,</span> <span class=mi>84</span><span class=p>,</span> <span class=mi>97</span><span class=p>,</span> <span class=mi>15</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>48</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>);</span>
    <span class=n>printargs</span><span class=p>(</span><span class=mi>84</span><span class=p>,</span> <span class=mi>51</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>);</span>
    <span class=n>printargs</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>);</span>
    <span class=n>printargs</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>);</span>
    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>範例二： avg.c
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=cp>#include</span> <span class=cpf>&lt;stdarg.h&gt;</span><span class=cp>
</span><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span><span class=cp>#include</span> <span class=cpf>&lt;stdint.h&gt;</span><span class=cp>
</span><span class=cp></span><span class=kt>double</span> <span class=nf>average</span><span class=p>(</span><span class=kt>int32_t</span> <span class=n>num</span><span class=p>,</span> <span class=p>...)</span> <span class=p>{</span>
    <span class=n>va_list</span> <span class=n>valist</span><span class=p>;</span>
    <span class=kt>int32_t</span> <span class=n>sum</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
    <span class=n>va_start</span><span class=p>(</span><span class=n>valist</span><span class=p>,</span> <span class=n>num</span><span class=p>);</span>
    <span class=k>for</span> <span class=p>(</span><span class=kt>int32_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>num</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
        <span class=n>sum</span> <span class=o>+=</span> <span class=n>va_arg</span><span class=p>(</span><span class=n>valist</span><span class=p>,</span> <span class=kt>int32_t</span><span class=p>);</span>
    <span class=n>va_end</span><span class=p>(</span><span class=n>valist</span><span class=p>);</span>
    <span class=k>return</span> <span class=n>sum</span> <span class=o>/</span> <span class=p>(</span><span class=kt>double</span><span class=p>)</span><span class=n>num</span><span class=p>;</span>
<span class=p>}</span>
<span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;Average of { 3, 4 } = %lf</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>average</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>));</span>
    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;Average of { 5, 10, 15 } = %lf</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>average</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>15</span><span class=p>));</span>
    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/tags/c/>C</a>
</section>
</footer>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css integrity=sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js integrity=sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script>
</article>
<aside class=related-contents--wrapper>
<h2 class=section-title>Related contents</h2>
<div class=related-contents>
<div class="flex article-list--tile">
<article>
<a href=/p/computer_programming_2-08/>
<div class=article-details>
<h2 class=article-title>程式設計(二)-08：Linux List</h2>
</div>
</a>
</article>
<article>
<a href=/p/computer_programming_2-07/>
<div class=article-details>
<h2 class=article-title>程式設計(二)-07：Some Tricks</h2>
</div>
</a>
</article>
<article>
<a href=/p/computer_programming_2-06/>
<div class=article-details>
<h2 class=article-title>程式設計(二)-06：Macro</h2>
</div>
</a>
</article>
<article>
<a href=/p/computer_programming_2-04/>
<div class=article-details>
<h2 class=article-title>程式設計(二)-04：File Processing-02</h2>
</div>
</a>
</article>
<article>
<a href=/p/computer_programming_2-03/>
<div class=article-details>
<h2 class=article-title>程式設計(二)-03：File Processing-01</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<footer class=site-footer>
<section class=copyright>
&copy;
2020 -
2022 小十的部落格
</section>
<section class=powerby>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.8.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
<aside class="sidebar right-sidebar sticky">
<section class="widget archives">
<div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
</div>
<h2 class="widget-title section-title">Table of contents</h2>
<div class=widget--toc>
<nav id=TableOfContents>
<ul>
<li><a href=#program-argument>Program Argument</a>
<ul>
<li>
<ul>
<li><a href=#argc-argv>argc, argv</a></li>
<li><a href=#getopt>getopt</a></li>
<li><a href=#getopt_long>getopt_long</a></li>
</ul>
</li>
</ul>
</li>
<li><a href=#variable-length-arguments>Variable Length Arguments</a></li>
</ul>
</nav>
</div>
</section>
</aside>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>