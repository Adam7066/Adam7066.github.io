<!doctype html><html lang=en-us>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="linuxlist.h  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141  #pragma once  struct list_head { struct list_head *next, *prev; }; #define LIST_HEAD_INIT(name) { &amp;amp;(name), &amp;amp;(name) }  #define LIST_HEAD(name) struct list_head name = LIST_HEAD_INIT(name)  /* * Insert a new entry between two known consecutive entries."><title>程式設計(二)-08：Linux List</title>
<link rel=canonical href=https://blog.smallten.tk/p/computer_programming_2-08/>
<link rel=stylesheet href=/scss/style.min.7b8cb8fa5c406df3cf5354584c5cbdb3b331e5fd452f9fe1168d563c1504f6de.css><meta property="og:title" content="程式設計(二)-08：Linux List">
<meta property="og:description" content="linuxlist.h  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141  #pragma once  struct list_head { struct list_head *next, *prev; }; #define LIST_HEAD_INIT(name) { &amp;amp;(name), &amp;amp;(name) }  #define LIST_HEAD(name) struct list_head name = LIST_HEAD_INIT(name)  /* * Insert a new entry between two known consecutive entries.">
<meta property="og:url" content="https://blog.smallten.tk/p/computer_programming_2-08/">
<meta property="og:site_name" content="小十的部落格">
<meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="C"><meta property="article:published_time" content="2021-07-13T22:25:50+08:00"><meta property="article:modified_time" content="2021-07-13T22:25:50+08:00">
<meta name=twitter:title content="程式設計(二)-08：Linux List">
<meta name=twitter:description content="linuxlist.h  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141  #pragma once  struct list_head { struct list_head *next, *prev; }; #define LIST_HEAD_INIT(name) { &amp;amp;(name), &amp;amp;(name) }  #define LIST_HEAD(name) struct list_head name = LIST_HEAD_INIT(name)  /* * Insert a new entry between two known consecutive entries.">
<link rel="shortcut icon" href=/image/favicon.png>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9L51K4B2CR"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-9L51K4B2CR',{anonymize_ip:!1})}</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9L51K4B2CR"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-9L51K4B2CR',{anonymize_ip:!1})}</script>
</head>
<body class=article-page>
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex
on-phone--column extended">
<aside class="sidebar left-sidebar sticky">
<button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box>
<span class=hamburger-inner></span>
</span>
</button>
<header class=site-info>
<figure class=site-avatar>
<a href=/>
<img src=/img/avatar_hu4cfb69605c22b48cecb92135d5094273_5680_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a>
</figure>
<h1 class=site-name><a href=/>小十的部落格</a></h1>
<h2 class=site-description>教學、資訊分享、生活記趣</h2><ol class=social-menu>
<li>
<a href=https://github.com/Adam7066 target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg>
</a>
</li>
</ol></header>
<ol class=menu id=main-menu>
<li>
<a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span>
</a>
</li>
<li>
<a href=/about><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span>
</a>
</li>
<li>
<a href=/archives><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span>
</a>
</li>
<li>
<a href=/search><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span>
</a>
</li>
<li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span>
</li>
</ol>
</aside>
<main class="main full-width">
<article class=main-article>
<header class=article-header>
<div class=article-details>
<header class=article-category>
<a href=/categories/%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88%E4%BA%8C/>
程式設計(二)
</a>
</header>
<h2 class=article-title>
<a href=/p/computer_programming_2-08/>程式設計(二)-08：Linux List</a>
</h2>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jul 13, 2021</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
5 minute read
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<ul>
<li>linuxlist.h</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=cp>#pragma once
</span><span class=cp></span>
<span class=k>struct</span> <span class=n>list_head</span> <span class=p>{</span>
    <span class=k>struct</span> <span class=n>list_head</span> <span class=o>*</span><span class=n>next</span><span class=p>,</span> <span class=o>*</span><span class=n>prev</span><span class=p>;</span>
<span class=p>};</span>

<span class=cp>#define LIST_HEAD_INIT(name) { &amp;(name), &amp;(name) }
</span><span class=cp></span>
<span class=cp>#define LIST_HEAD(name) struct list_head name = LIST_HEAD_INIT(name)
</span><span class=cp></span>
<span class=cm>/*
</span><span class=cm> * Insert a new entry between two known consecutive entries.
</span><span class=cm> *
</span><span class=cm> * This is only for internal list manipulation where we know
</span><span class=cm> * the prev/next entries already!
</span><span class=cm> */</span>
<span class=k>static</span> <span class=kr>inline</span> <span class=kt>void</span> <span class=nf>__list_add</span><span class=p>(</span><span class=k>struct</span> <span class=n>list_head</span> <span class=o>*</span><span class=n>new</span><span class=p>,</span>
                              <span class=k>struct</span> <span class=n>list_head</span> <span class=o>*</span><span class=n>prev</span><span class=p>,</span>
                              <span class=k>struct</span> <span class=n>list_head</span> <span class=o>*</span><span class=n>next</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>next</span><span class=o>-&gt;</span><span class=n>prev</span> <span class=o>=</span> <span class=n>new</span><span class=p>;</span>
    <span class=n>new</span><span class=o>-&gt;</span><span class=n>next</span> <span class=o>=</span> <span class=n>next</span><span class=p>;</span>
    <span class=n>new</span><span class=o>-&gt;</span><span class=n>prev</span> <span class=o>=</span> <span class=n>prev</span><span class=p>;</span>
    <span class=n>prev</span><span class=o>-&gt;</span><span class=n>next</span> <span class=o>=</span> <span class=n>new</span><span class=p>;</span>
<span class=p>}</span>

<span class=cm>/**
</span><span class=cm> * list_add - add a new entry
</span><span class=cm> * @new: new entry to be added
</span><span class=cm> * @head: list head to add it after
</span><span class=cm> *
</span><span class=cm> * Insert a new entry after the specified head.
</span><span class=cm> * This is good for implementing stacks.
</span><span class=cm> */</span>
<span class=k>static</span> <span class=kr>inline</span> <span class=kt>void</span> <span class=nf>list_add</span><span class=p>(</span><span class=k>struct</span> <span class=n>list_head</span> <span class=o>*</span><span class=n>new</span><span class=p>,</span> <span class=k>struct</span> <span class=n>list_head</span> <span class=o>*</span><span class=n>head</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>__list_add</span><span class=p>(</span><span class=n>new</span><span class=p>,</span> <span class=n>head</span><span class=p>,</span> <span class=n>head</span><span class=o>-&gt;</span><span class=n>next</span><span class=p>);</span>
<span class=p>}</span>


<span class=cm>/**
</span><span class=cm> * list_add_tail - add a new entry
</span><span class=cm> * @new: new entry to be added
</span><span class=cm> * @head: list head to add it before
</span><span class=cm> *
</span><span class=cm> * Insert a new entry before the specified head.
</span><span class=cm> * This is useful for implementing queues.
</span><span class=cm> */</span>
<span class=k>static</span> <span class=kr>inline</span> <span class=kt>void</span> <span class=nf>list_add_tail</span><span class=p>(</span><span class=k>struct</span> <span class=n>list_head</span> <span class=o>*</span><span class=n>new</span><span class=p>,</span> <span class=k>struct</span> <span class=n>list_head</span> <span class=o>*</span><span class=n>head</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>__list_add</span><span class=p>(</span><span class=n>new</span><span class=p>,</span> <span class=n>head</span><span class=o>-&gt;</span><span class=n>prev</span><span class=p>,</span> <span class=n>head</span><span class=p>);</span>
<span class=p>}</span>

<span class=cm>/*
</span><span class=cm> * Delete a list entry by making the prev/next entries
</span><span class=cm> * point to each other.
</span><span class=cm> *
</span><span class=cm> * This is only for internal list manipulation where we know
</span><span class=cm> * the prev/next entries already!
</span><span class=cm> */</span>
<span class=k>static</span> <span class=kr>inline</span> <span class=kt>void</span> <span class=nf>__list_del</span><span class=p>(</span><span class=k>struct</span> <span class=n>list_head</span> <span class=o>*</span> <span class=n>prev</span><span class=p>,</span> <span class=k>struct</span> <span class=n>list_head</span> <span class=o>*</span> <span class=n>next</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>next</span><span class=o>-&gt;</span><span class=n>prev</span> <span class=o>=</span> <span class=n>prev</span><span class=p>;</span>
    <span class=n>prev</span><span class=o>-&gt;</span><span class=n>next</span> <span class=o>=</span> <span class=n>next</span><span class=p>;</span>
<span class=p>}</span>

<span class=cm>/**
</span><span class=cm> * list_del - deletes entry from list.
</span><span class=cm> * @entry: the element to delete from the list.
</span><span class=cm> * Note: list_empty() on entry does not return true after this, the entry is
</span><span class=cm> * in an undefined state.
</span><span class=cm> */</span>
<span class=k>static</span> <span class=kr>inline</span> <span class=kt>void</span> <span class=nf>__list_del_entry</span><span class=p>(</span><span class=k>struct</span> <span class=n>list_head</span> <span class=o>*</span><span class=n>entry</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>entry</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span>
        <span class=k>return</span><span class=p>;</span>

    <span class=n>__list_del</span><span class=p>(</span><span class=n>entry</span><span class=o>-&gt;</span><span class=n>prev</span><span class=p>,</span> <span class=n>entry</span><span class=o>-&gt;</span><span class=n>next</span><span class=p>);</span>
<span class=p>}</span>

<span class=k>static</span> <span class=kr>inline</span> <span class=kt>void</span> <span class=nf>list_del</span><span class=p>(</span><span class=k>struct</span> <span class=n>list_head</span> <span class=o>*</span><span class=n>entry</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>__list_del_entry</span><span class=p>(</span><span class=n>entry</span><span class=p>);</span>
    <span class=n>entry</span><span class=o>-&gt;</span><span class=n>next</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
    <span class=n>entry</span><span class=o>-&gt;</span><span class=n>prev</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
<span class=p>}</span>

<span class=cm>/**
</span><span class=cm> * list_empty - tests whether a list is empty
</span><span class=cm> * @head: the list to test.
</span><span class=cm> */</span>
<span class=k>static</span> <span class=kr>inline</span> <span class=kt>int</span> <span class=nf>list_empty</span><span class=p>(</span><span class=k>const</span> <span class=k>struct</span> <span class=n>list_head</span> <span class=o>*</span><span class=n>head</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=n>head</span> <span class=o>-&gt;</span> <span class=n>next</span> <span class=o>==</span> <span class=n>head</span><span class=p>;</span>
<span class=p>}</span>

<span class=cp>#define offsetof(TYPE, MEMBER) ((size_t)&amp;((TYPE *)0)-&gt;MEMBER)
</span><span class=cp></span>
<span class=cp>#define container_of(ptr, type, member) ({				\
</span><span class=cp>	void *__mptr = (void *)(ptr);					\
</span><span class=cp>	((type *)(__mptr - offsetof(type, member))); })
</span><span class=cp></span>
<span class=cm>/**
</span><span class=cm> * list_entry - get the struct for this entry
</span><span class=cm> * @ptr:	the &amp;struct list_head pointer.
</span><span class=cm> * @type:	the type of the struct this is embedded in.
</span><span class=cm> * @member:	the name of the list_head within the struct.
</span><span class=cm> */</span>
<span class=cp>#define list_entry(ptr, type, member) \
</span><span class=cp>    container_of(ptr, type, member)
</span><span class=cp></span>
<span class=cm>/**
</span><span class=cm> * list_first_entry - get the first element from a list
</span><span class=cm> * @ptr:	the list head to take the element from.
</span><span class=cm> * @type:	the type of the struct this is embedded in.
</span><span class=cm> * @member:	the name of the list_head within the struct.
</span><span class=cm> *
</span><span class=cm> * Note, that list is expected to be not empty.
</span><span class=cm> */</span>
<span class=cp>#define list_first_entry(ptr, type, member) \
</span><span class=cp>    list_entry((ptr)-&gt;next, type, member)
</span><span class=cp></span>
<span class=cm>/**
</span><span class=cm> * list_last_entry - get the last element from a list
</span><span class=cm> * @ptr:	the list head to take the element from.
</span><span class=cm> * @type:	the type of the struct this is embedded in.
</span><span class=cm> * @member:	the name of the list_head within the struct.
</span><span class=cm> *
</span><span class=cm> * Note, that list is expected to be not empty.
</span><span class=cm> */</span>
<span class=cp>#define list_last_entry(ptr, type, member) \
</span><span class=cp>    list_entry((ptr)-&gt;prev, type, member)
</span><span class=cp></span>
<span class=cm>/**
</span><span class=cm> * list_for_each	-	iterate over a list
</span><span class=cm> * @pos:	the &amp;struct list_head to use as a loop cursor.
</span><span class=cm> * @head:	the head for your list.
</span><span class=cm> */</span>
<span class=cp>#define list_for_each(pos, head) \
</span><span class=cp>    for (pos = (head)-&gt;next; pos != (head); pos = pos-&gt;next)
</span><span class=cp></span>
<span class=cm>/**
</span><span class=cm> * list_for_each_prev	-	iterate over a list backwards
</span><span class=cm> * @pos:	the &amp;struct list_head to use as a loop cursor.
</span><span class=cm> * @head:	the head for your list.
</span><span class=cm> */</span>
<span class=cp>#define list_for_each_prev(pos, head) \
</span><span class=cp>    for (pos = (head)-&gt;prev; pos != (head); pos = pos-&gt;prev)
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>main.c</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span><span class=cp>#include</span> <span class=cpf>&lt;stdint.h&gt;</span><span class=cp>
</span><span class=cp>#include</span> <span class=cpf>&lt;time.h&gt;</span><span class=cp>
</span><span class=cp>#include</span> <span class=cpf>&#34;linuxlist.h&#34;</span><span class=cp>
</span><span class=cp></span><span class=k>typedef</span> <span class=k>struct</span> <span class=n>_sCharacter</span> <span class=p>{</span>
    <span class=kt>int32_t</span> <span class=n>id</span><span class=p>;</span>
    <span class=kt>char</span>    <span class=n>name</span><span class=p>[</span><span class=mi>32</span><span class=p>];</span>
    <span class=kt>int32_t</span> <span class=n>hp</span><span class=p>;</span>
    <span class=kt>int32_t</span> <span class=n>mp</span><span class=p>;</span>
    <span class=kt>int32_t</span> <span class=n>exp</span><span class=p>;</span>
    <span class=kt>int32_t</span> <span class=n>atk</span><span class=p>;</span>
    <span class=kt>int32_t</span> <span class=n>def</span><span class=p>;</span>
    <span class=kt>int32_t</span> <span class=n>ats</span><span class=p>;</span>
    <span class=kt>int32_t</span> <span class=n>adf</span><span class=p>;</span>
    <span class=kt>int32_t</span> <span class=n>spd</span><span class=p>;</span>

    <span class=k>struct</span> <span class=n>list_head</span> <span class=n>list</span><span class=p>;</span>
<span class=p>}</span> <span class=n>sCharacter</span><span class=p>;</span>
<span class=n>sCharacter</span> <span class=o>*</span><span class=nf>allocCharacter</span><span class=p>(</span><span class=kt>int32_t</span> <span class=n>id</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>sCharacter</span> <span class=o>*</span><span class=n>newComer</span> <span class=o>=</span> <span class=n>calloc</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>sCharacter</span><span class=p>));</span>
    <span class=n>newComer</span><span class=o>-&gt;</span><span class=n>id</span> <span class=o>=</span> <span class=n>id</span><span class=p>;</span>
    <span class=n>newComer</span><span class=o>-&gt;</span><span class=n>name</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>rand</span><span class=p>()</span> <span class=o>%</span> <span class=mi>26</span> <span class=o>+</span> <span class=sc>&#39;A&#39;</span><span class=p>;</span>
    <span class=k>for</span><span class=p>(</span><span class=kt>int32_t</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>1</span> <span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=mi>6</span> <span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span>
        <span class=n>newComer</span><span class=o>-&gt;</span><span class=n>name</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>rand</span><span class=p>()</span> <span class=o>%</span> <span class=mi>26</span> <span class=o>+</span> <span class=sc>&#39;a&#39;</span><span class=p>;</span>
    <span class=n>newComer</span><span class=o>-&gt;</span><span class=n>hp</span> <span class=o>=</span> <span class=n>rand</span><span class=p>()</span> <span class=o>%</span> <span class=mi>100</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
    <span class=n>newComer</span><span class=o>-&gt;</span><span class=n>mp</span> <span class=o>=</span> <span class=n>rand</span><span class=p>()</span> <span class=o>%</span> <span class=mi>100</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
    <span class=n>newComer</span><span class=o>-&gt;</span><span class=n>exp</span> <span class=o>=</span> <span class=n>rand</span><span class=p>()</span> <span class=o>%</span> <span class=mi>100</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
    <span class=n>newComer</span><span class=o>-&gt;</span><span class=n>atk</span> <span class=o>=</span> <span class=n>rand</span><span class=p>()</span> <span class=o>%</span> <span class=mi>100</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
    <span class=n>newComer</span><span class=o>-&gt;</span><span class=n>def</span> <span class=o>=</span> <span class=n>rand</span><span class=p>()</span> <span class=o>%</span> <span class=mi>100</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
    <span class=n>newComer</span><span class=o>-&gt;</span><span class=n>ats</span> <span class=o>=</span> <span class=n>rand</span><span class=p>()</span> <span class=o>%</span> <span class=mi>100</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
    <span class=n>newComer</span><span class=o>-&gt;</span><span class=n>adf</span> <span class=o>=</span> <span class=n>rand</span><span class=p>()</span> <span class=o>%</span> <span class=mi>100</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
    <span class=n>newComer</span><span class=o>-&gt;</span><span class=n>spd</span> <span class=o>=</span> <span class=n>rand</span><span class=p>()</span> <span class=o>%</span> <span class=mi>100</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>

    <span class=k>return</span> <span class=n>newComer</span><span class=p>;</span>
<span class=p>}</span>
<span class=kt>void</span> <span class=nf>printCharacter</span><span class=p>(</span><span class=n>sCharacter</span> <span class=o>*</span><span class=n>one</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;%04d) &#34;</span><span class=p>,</span> <span class=n>one</span><span class=o>-&gt;</span><span class=n>id</span><span class=p>);</span>
    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;%8s &#34;</span><span class=p>,</span> <span class=n>one</span><span class=o>-&gt;</span><span class=n>name</span><span class=p>);</span>
    <span class=k>for</span><span class=p>(</span><span class=kt>int32_t</span> <span class=o>*</span><span class=n>ptr</span> <span class=o>=</span> <span class=o>&amp;</span><span class=p>(</span><span class=n>one</span><span class=o>-&gt;</span><span class=n>hp</span><span class=p>);</span> <span class=n>ptr</span> <span class=o>&lt;=</span> <span class=o>&amp;</span><span class=p>(</span><span class=n>one</span><span class=o>-&gt;</span><span class=n>spd</span><span class=p>);</span> <span class=n>ptr</span><span class=o>++</span><span class=p>)</span>
        <span class=n>printf</span><span class=p>(</span><span class=s>&#34;%3d &#34;</span><span class=p>,</span> <span class=o>*</span><span class=n>ptr</span><span class=p>);</span>
    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
    <span class=k>return</span><span class=p>;</span>
<span class=p>}</span>
<span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
    <span class=n>LIST_HEAD</span><span class=p>(</span><span class=n>char_list_head</span><span class=p>);</span>
    <span class=n>srand</span><span class=p>(</span><span class=n>time</span><span class=p>(</span><span class=mi>0</span><span class=p>));</span>
    <span class=k>for</span><span class=p>(</span><span class=kt>int32_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span> <span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>1000</span> <span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>sCharacter</span> <span class=o>*</span><span class=n>newComer</span> <span class=o>=</span> <span class=n>allocCharacter</span><span class=p>(</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
        <span class=n>list_add</span><span class=p>(</span><span class=o>&amp;</span><span class=p>(</span><span class=n>newComer</span><span class=o>-&gt;</span><span class=n>list</span><span class=p>),</span> <span class=o>&amp;</span><span class=n>char_list_head</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=k>struct</span> <span class=n>list_head</span> <span class=o>*</span><span class=n>listptr</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
    <span class=n>list_for_each</span><span class=p>(</span><span class=n>listptr</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>char_list_head</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>sCharacter</span> <span class=o>*</span><span class=n>cptr</span> <span class=o>=</span> <span class=n>list_entry</span><span class=p>(</span><span class=n>listptr</span><span class=p>,</span> <span class=n>sCharacter</span><span class=p>,</span> <span class=n>list</span><span class=p>);</span>
        <span class=n>printCharacter</span><span class=p>(</span><span class=n>cptr</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=cm>/*
</span><span class=cm>    list_for_each_prev(listptr, &amp;char_list_head) {
</span><span class=cm>        sCharacter *cptr = list_entry(listptr, sCharacter, list);
</span><span class=cm>        printCharacter(cptr);
</span><span class=cm>    }
</span><span class=cm>    */</span>
    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/tags/c/>C</a>
</section>
</footer>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css integrity=sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js integrity=sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script>
</article>
<aside class=related-contents--wrapper>
<h2 class=section-title>Related contents</h2>
<div class=related-contents>
<div class="flex article-list--tile">
<article>
<a href=/p/computer_programming_2-07/>
<div class=article-details>
<h2 class=article-title>程式設計(二)-07：Some Tricks</h2>
</div>
</a>
</article>
<article>
<a href=/p/computer_programming_2-06/>
<div class=article-details>
<h2 class=article-title>程式設計(二)-06：Macro</h2>
</div>
</a>
</article>
<article>
<a href=/p/computer_programming_2-05/>
<div class=article-details>
<h2 class=article-title>程式設計(二)-05：Variable Length Arguments List</h2>
</div>
</a>
</article>
<article>
<a href=/p/computer_programming_2-04/>
<div class=article-details>
<h2 class=article-title>程式設計(二)-04：File Processing-02</h2>
</div>
</a>
</article>
<article>
<a href=/p/computer_programming_2-03/>
<div class=article-details>
<h2 class=article-title>程式設計(二)-03：File Processing-01</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<footer class=site-footer>
<section class=copyright>
&copy;
2020 -
2022 小十的部落格
</section>
<section class=powerby>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.8.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>